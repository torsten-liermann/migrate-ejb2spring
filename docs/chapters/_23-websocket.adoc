== WebSocket
Jakarta WebSocket defines endpoints via `@ServerEndpoint` and optionally `@OnOpen`, `@OnMessage`, `@OnClose`. Spring Boot uses the Spring WebSocket model with `WebSocketHandler` or `@MessageMapping` in combination with STOMP. The migration needs to re-evaluate communication style, session management and threading.
.Specification references
****
* https://jakarta.ee/specifications/websocket/2.1/jakarta-websocket-spec-2.1.html[Jakarta WebSocket 2.1 Spec]
* https://jakarta.ee/specifications/websocket/2.1/jakarta-websocket-spec-2.1.html#server-endpoint[Jakarta WebSocket 2.1 - ยง3.1 @ServerEndpoint]
* https://jakarta.ee/specifications/websocket/2.1/jakarta-websocket-spec-2.1.html#messaging[Jakarta WebSocket 2.1 - Chapter 5: Messaging]
* https://docs.spring.io/spring-framework/reference/web/websocket.html[Spring WebSocket Reference]
****

=== ServerEndpoint to Spring WebSocket
.Example: BEFORE (Jakarta WebSocket)
[source, java]
----
import javax.websocket.*;
import javax.websocket.server.ServerEndpoint;

@ServerEndpoint("/tracking")
public class TrackingEndpoint {

    @OnMessage
    public void onMessage(String payload, Session session) {
        handle(payload, session);
    }
}
----

.Example: AFTER (Spring WebSocket)
[source, java]
----
import org.springframework.web.socket.TextMessage;
import org.springframework.web.socket.WebSocketSession;
import org.springframework.web.socket.handler.TextWebSocketHandler;

public class TrackingHandler extends TextWebSocketHandler {

    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) {
        handle(message.getPayload(), session);
    }
}
----

=== Messaging and STOMP
If the application uses STOMP or a message broker model, it is recommended to use @MessageMapping and Spring Messaging. This has an impact on paths, payload formats and security handling.
=== Migration notes
The lifetime of a WebSocket session is container managed in Jakarta EE. In Spring, session attributes, heartbeats, and possible scaling strategies (e.g. WebSocket session replication) must be explicitly configured.
The WebSocket specification describes that one endpoint instance is used per connected peer, unless a separate configurator defines a different strategy. Session user properties are retained until 'onClose'; in distributed containers they must be serializable to allow session migration. These semantics must be explicitly taken into account when migrating to Spring.
When `@ServerEndpoint` is persisted in Spring Boot, Endpoint instances are created by the WebSocket container and not by Spring. In this case, Spring injection is only possible via special configurator mechanisms and must be explicitly provided for in the project.
=== Automated migration
[cols="1.3"]
|===
| Name | `com.github.rewrite.ejb.MarkWebSocketForMigration`
| Description | Marks `@ServerEndpoint`/`@ClientEndpoint` classes with `@NeedsReview(category=MANUAL_MIGRATION)`.
| Configuration | none
|===

See also: link:../migration-guide/websocket-migration.md[WebSocket Migration Guide]
